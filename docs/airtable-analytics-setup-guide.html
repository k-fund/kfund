<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Airtable Analytics 테이블 설정 가이드 - ibn</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .step-number {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #1D00AD, #4F46E5);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
      flex-shrink: 0;
    }
    .copy-btn {
      transition: all 0.2s;
    }
    .copy-btn:hover {
      transform: scale(1.05);
    }
    .copy-btn.copied {
      background: #10B981 !important;
    }
    .field-row {
      display: grid;
      grid-template-columns: 160px 140px 1fr;
      gap: 12px;
      align-items: center;
      padding: 12px;
      border-radius: 8px;
      transition: background 0.2s;
    }
    .field-row:hover {
      background: #F9FAFB;
    }
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border: 1px solid #E5E7EB;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .checkbox-item:hover {
      border-color: #1D00AD;
      background: #F9FAFB;
    }
    .checkbox-item.checked {
      border-color: #10B981;
      background: #ECFDF5;
    }
    .checkbox-item.checked .check-icon {
      background: #10B981;
      border-color: #10B981;
    }
    .check-icon {
      width: 24px;
      height: 24px;
      border: 2px solid #D1D5DB;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .path-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #F3F4F6;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
      color: #4B5563;
    }
    .path-arrow {
      color: #9CA3AF;
    }
    .warning-box {
      background: #FEF3C7;
      border: 1px solid #F59E0B;
      border-radius: 8px;
      padding: 16px;
    }
    .success-box {
      background: #ECFDF5;
      border: 1px solid #10B981;
      border-radius: 8px;
      padding: 16px;
    }
    .code-block {
      background: #1F2937;
      color: #F9FAFB;
      border-radius: 8px;
      padding: 16px;
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 13px;
      position: relative;
    }
    .progress-bar {
      height: 8px;
      background: #E5E7EB;
      border-radius: 4px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #1D00AD, #10B981);
      transition: width 0.5s ease;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Header -->
  <div class="bg-white border-b sticky top-0 z-10">
    <div class="max-w-3xl mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-xl font-bold text-gray-900">Airtable Analytics 테이블 설정</h1>
          <p class="text-sm text-gray-500 mt-1">ibn 방문통계 캐시 시스템</p>
        </div>
        <div class="text-right">
          <div class="text-sm text-gray-500">진행률</div>
          <div class="text-lg font-bold text-indigo-600" id="progressText">0%</div>
        </div>
      </div>
      <div class="progress-bar mt-3">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
    </div>
  </div>

  <div class="max-w-3xl mx-auto px-6 py-8">
    <!-- 목적 설명 -->
    <div class="bg-indigo-50 border border-indigo-200 rounded-xl p-6 mb-8">
      <h2 class="font-semibold text-indigo-900 mb-2">이 테이블의 목적</h2>
      <p class="text-indigo-800 text-sm leading-relaxed">
        <code class="bg-indigo-100 px-1.5 py-0.5 rounded">analytics_daily</code> 테이블은 GA4 API 호출 제한을 방지하고
        빠른 데이터 조회를 위해 <strong>매일 새벽 1시(KST)</strong>에 GA4 데이터를 자동으로 수집하여 저장합니다.
        관리자 페이지의 "기간별 누적 데이터" 섹션에서 이 캐시 데이터를 조회합니다.
      </p>
    </div>

    <!-- 체크리스트 -->
    <div class="bg-white rounded-xl border p-6 mb-8">
      <h2 class="font-semibold text-gray-900 mb-4">설정 체크리스트</h2>
      <div class="space-y-3">
        <div class="checkbox-item" data-step="1" onclick="toggleCheck(this)">
          <div class="check-icon">
            <svg class="w-4 h-4 text-white hidden" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div>
            <div class="font-medium text-gray-900">Airtable Base 접속</div>
            <div class="text-sm text-gray-500">ibn Airtable Base 열기</div>
          </div>
        </div>
        <div class="checkbox-item" data-step="2" onclick="toggleCheck(this)">
          <div class="check-icon">
            <svg class="w-4 h-4 text-white hidden" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div>
            <div class="font-medium text-gray-900">analytics_daily 테이블 생성</div>
            <div class="text-sm text-gray-500">새 테이블 추가 및 이름 설정</div>
          </div>
        </div>
        <div class="checkbox-item" data-step="3" onclick="toggleCheck(this)">
          <div class="check-icon">
            <svg class="w-4 h-4 text-white hidden" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div>
            <div class="font-medium text-gray-900">필드 6개 생성</div>
            <div class="text-sm text-gray-500">date, visitors, pageviews, avg_duration, bounce_rate, collected_at</div>
          </div>
        </div>
        <div class="checkbox-item" data-step="4" onclick="toggleCheck(this)">
          <div class="check-icon">
            <svg class="w-4 h-4 text-white hidden" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div>
            <div class="font-medium text-gray-900">테스트 완료</div>
            <div class="text-sm text-gray-500">백필 API 호출 및 데이터 확인</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 1 -->
    <div class="bg-white rounded-xl border p-6 mb-6">
      <div class="flex items-start gap-4 mb-4">
        <div class="step-number">1</div>
        <div>
          <h3 class="font-semibold text-gray-900">Airtable Base 접속</h3>
          <p class="text-sm text-gray-600 mt-1">ibn Airtable 워크스페이스에 접속합니다.</p>
        </div>
      </div>

      <div class="ml-12">
        <a href="https://airtable.com" target="_blank" class="inline-flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
          </svg>
          Airtable 열기
        </a>

        <div class="mt-4 path-indicator">
          Workspaces <span class="path-arrow">→</span> ibn <span class="path-arrow">→</span> Base 선택
        </div>
      </div>
    </div>

    <!-- Step 2 -->
    <div class="bg-white rounded-xl border p-6 mb-6">
      <div class="flex items-start gap-4 mb-4">
        <div class="step-number">2</div>
        <div>
          <h3 class="font-semibold text-gray-900">새 테이블 생성</h3>
          <p class="text-sm text-gray-600 mt-1">Base 왼쪽 하단의 <strong>+ Add or import</strong> 버튼을 클릭합니다.</p>
        </div>
      </div>

      <div class="ml-12">
        <div class="bg-gray-50 rounded-lg p-4 mb-4">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-8 h-8 bg-green-100 rounded flex items-center justify-center">
              <span class="text-green-600">+</span>
            </div>
            <span class="text-gray-700">Create blank table 선택</span>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <span class="text-gray-600">테이블 이름:</span>
          <div class="flex items-center gap-2">
            <code class="bg-gray-100 px-3 py-1.5 rounded font-mono text-indigo-700" id="tableName">analytics_daily</code>
            <button onclick="copyText('tableName')" class="copy-btn bg-gray-200 hover:bg-gray-300 px-3 py-1.5 rounded text-sm">
              복사
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 3 -->
    <div class="bg-white rounded-xl border p-6 mb-6">
      <div class="flex items-start gap-4 mb-4">
        <div class="step-number">3</div>
        <div>
          <h3 class="font-semibold text-gray-900">필드 생성</h3>
          <p class="text-sm text-gray-600 mt-1">아래 6개 필드를 순서대로 생성합니다.</p>
        </div>
      </div>

      <div class="ml-12">
        <div class="bg-gray-50 rounded-lg overflow-hidden">
          <div class="field-row bg-gray-100 font-semibold text-gray-700 text-sm">
            <div>필드명</div>
            <div>타입</div>
            <div>설명</div>
          </div>

          <div class="field-row border-b">
            <div class="flex items-center gap-2">
              <code class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded text-sm">date</code>
              <button onclick="copyField('date')" class="copy-btn text-gray-400 hover:text-indigo-600">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
              </button>
            </div>
            <div class="text-sm text-gray-600">Single line text</div>
            <div class="text-sm text-gray-500">날짜 (YYYY-MM-DD)</div>
          </div>

          <div class="field-row border-b">
            <div class="flex items-center gap-2">
              <code class="bg-green-100 text-green-700 px-2 py-1 rounded text-sm">visitors</code>
              <button onclick="copyField('visitors')" class="copy-btn text-gray-400 hover:text-green-600">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
              </button>
            </div>
            <div class="text-sm text-gray-600">Number</div>
            <div class="text-sm text-gray-500">일일 방문자 수</div>
          </div>

          <div class="field-row border-b">
            <div class="flex items-center gap-2">
              <code class="bg-blue-100 text-blue-700 px-2 py-1 rounded text-sm">pageviews</code>
              <button onclick="copyField('pageviews')" class="copy-btn text-gray-400 hover:text-blue-600">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
              </button>
            </div>
            <div class="text-sm text-gray-600">Number</div>
            <div class="text-sm text-gray-500">일일 페이지뷰 수</div>
          </div>

          <div class="field-row border-b">
            <div class="flex items-center gap-2">
              <code class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-sm">avg_duration</code>
              <button onclick="copyField('avg_duration')" class="copy-btn text-gray-400 hover:text-yellow-600">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
              </button>
            </div>
            <div class="text-sm text-gray-600">Number</div>
            <div class="text-sm text-gray-500">평균 체류시간 (초)</div>
          </div>

          <div class="field-row border-b">
            <div class="flex items-center gap-2">
              <code class="bg-red-100 text-red-700 px-2 py-1 rounded text-sm">bounce_rate</code>
              <button onclick="copyField('bounce_rate')" class="copy-btn text-gray-400 hover:text-red-600">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
              </button>
            </div>
            <div class="text-sm text-gray-600">Number</div>
            <div class="text-sm text-gray-500">이탈률 (0~1 소수)</div>
          </div>

          <div class="field-row">
            <div class="flex items-center gap-2">
              <code class="bg-purple-100 text-purple-700 px-2 py-1 rounded text-sm">collected_at</code>
              <button onclick="copyField('collected_at')" class="copy-btn text-gray-400 hover:text-purple-600">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
              </button>
            </div>
            <div class="text-sm text-gray-600">Single line text</div>
            <div class="text-sm text-gray-500">수집 시간 (ISO 형식)</div>
          </div>
        </div>

        <div class="warning-box mt-4">
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-yellow-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
            <div>
              <div class="font-medium text-yellow-800">필드명 정확히 입력</div>
              <div class="text-sm text-yellow-700 mt-1">
                Worker 코드와 필드명이 정확히 일치해야 합니다. 대소문자, 언더스코어(_) 등 정확히 입력해주세요.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 4 -->
    <div class="bg-white rounded-xl border p-6 mb-6">
      <div class="flex items-start gap-4 mb-4">
        <div class="step-number">4</div>
        <div>
          <h3 class="font-semibold text-gray-900">백필 및 테스트</h3>
          <p class="text-sm text-gray-600 mt-1">테이블 생성 후, 백필 API를 호출하여 과거 데이터를 채웁니다.</p>
        </div>
      </div>

      <div class="ml-12">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">백필 일수 선택</label>
          <div class="flex gap-2">
            <button onclick="setBackfillDays(7)" class="backfill-btn px-4 py-2 border rounded-lg hover:bg-indigo-50 active">7일</button>
            <button onclick="setBackfillDays(30)" class="backfill-btn px-4 py-2 border rounded-lg hover:bg-indigo-50">30일</button>
            <button onclick="setBackfillDays(90)" class="backfill-btn px-4 py-2 border rounded-lg hover:bg-indigo-50">90일</button>
          </div>
        </div>

        <div class="code-block mb-4">
          <div class="flex items-center justify-between mb-2">
            <span class="text-gray-400 text-xs">백필 API 호출 URL</span>
            <button onclick="copyBackfillUrl()" class="copy-btn bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded text-xs text-white">복사</button>
          </div>
          <code id="backfillUrl">https://ibn-analytics.urbane9293.workers.dev/backfill?days=7</code>
        </div>

        <button onclick="testBackfill()" id="backfillBtn" class="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition flex items-center justify-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
          백필 실행
        </button>

        <div id="backfillResult" class="mt-4 hidden"></div>
      </div>
    </div>

    <!-- 완료 섹션 -->
    <div class="success-box" id="completionBox" style="display: none;">
      <div class="flex items-start gap-3">
        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <div>
          <div class="font-semibold text-green-800">설정 완료!</div>
          <div class="text-sm text-green-700 mt-1">
            analytics_daily 테이블이 정상적으로 설정되었습니다.<br>
            이제 매일 새벽 1시(KST)에 자동으로 GA4 데이터가 수집됩니다.
          </div>
          <a href="/admin/analytics.html" class="inline-flex items-center gap-2 mt-3 text-green-700 hover:text-green-900 font-medium">
            방문통계 페이지에서 확인하기 →
          </a>
        </div>
      </div>
    </div>

    <!-- 문제 해결 -->
    <div class="bg-white rounded-xl border p-6 mt-8">
      <h3 class="font-semibold text-gray-900 mb-4">문제 해결</h3>
      <div class="space-y-4 text-sm">
        <div>
          <div class="font-medium text-gray-700">Q. 백필 실행 시 "TABLE_NOT_FOUND" 오류</div>
          <div class="text-gray-600 mt-1">→ 테이블명이 정확히 <code class="bg-gray-100 px-1 rounded">analytics_daily</code>인지 확인하세요.</div>
        </div>
        <div>
          <div class="font-medium text-gray-700">Q. 필드에 데이터가 저장되지 않음</div>
          <div class="text-gray-600 mt-1">→ 필드명이 정확한지 (특히 언더스코어 _) 확인하세요.</div>
        </div>
        <div>
          <div class="font-medium text-gray-700">Q. Cron이 작동하지 않음</div>
          <div class="text-gray-600 mt-1">→ Cloudflare 대시보드에서 Workers → Triggers → Cron 설정을 확인하세요.</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let backfillDays = 7;
    let checkedSteps = new Set();

    function toggleCheck(el) {
      const step = el.dataset.step;
      el.classList.toggle('checked');
      const icon = el.querySelector('svg');

      if (el.classList.contains('checked')) {
        icon.classList.remove('hidden');
        checkedSteps.add(step);
      } else {
        icon.classList.add('hidden');
        checkedSteps.delete(step);
      }

      updateProgress();
    }

    function updateProgress() {
      const total = 4;
      const completed = checkedSteps.size;
      const percent = Math.round((completed / total) * 100);

      document.getElementById('progressText').textContent = percent + '%';
      document.getElementById('progressFill').style.width = percent + '%';

      if (percent === 100) {
        document.getElementById('completionBox').style.display = 'block';
      } else {
        document.getElementById('completionBox').style.display = 'none';
      }
    }

    function copyText(elementId) {
      const text = document.getElementById(elementId).textContent;
      navigator.clipboard.writeText(text);
      showCopyFeedback(event.target);
    }

    function copyField(fieldName) {
      navigator.clipboard.writeText(fieldName);
      showCopyFeedback(event.target.closest('.copy-btn'));
    }

    function copyBackfillUrl() {
      const url = document.getElementById('backfillUrl').textContent;
      navigator.clipboard.writeText(url);
      showCopyFeedback(event.target);
    }

    function showCopyFeedback(btn) {
      btn.classList.add('copied');
      const originalText = btn.textContent;
      btn.textContent = '복사됨!';
      setTimeout(() => {
        btn.classList.remove('copied');
        btn.textContent = originalText;
      }, 1500);
    }

    function setBackfillDays(days) {
      backfillDays = days;
      document.querySelectorAll('.backfill-btn').forEach(btn => btn.classList.remove('active', 'bg-indigo-100', 'border-indigo-500'));
      event.target.classList.add('active', 'bg-indigo-100', 'border-indigo-500');
      document.getElementById('backfillUrl').textContent =
        `https://ibn-analytics.urbane9293.workers.dev/backfill?days=${days}`;
    }

    async function testBackfill() {
      const btn = document.getElementById('backfillBtn');
      const resultDiv = document.getElementById('backfillResult');

      btn.disabled = true;
      btn.innerHTML = '<svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> 백필 중...';

      try {
        const response = await fetch(`https://ibn-analytics.urbane9293.workers.dev/backfill?days=${backfillDays}`);
        const data = await response.json();

        resultDiv.classList.remove('hidden');

        if (data.success) {
          resultDiv.innerHTML = `
            <div class="success-box">
              <div class="flex items-center gap-2 text-green-800 font-medium">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                백필 완료!
              </div>
              <div class="text-sm text-green-700 mt-2">
                ${data.processed || backfillDays}일치 데이터가 저장되었습니다.
              </div>
            </div>
          `;

          // 자동 체크
          const step4 = document.querySelector('[data-step="4"]');
          if (!step4.classList.contains('checked')) {
            toggleCheck(step4);
          }
        } else {
          resultDiv.innerHTML = `
            <div class="warning-box">
              <div class="font-medium text-yellow-800">오류 발생</div>
              <div class="text-sm text-yellow-700 mt-1">${data.error || '알 수 없는 오류'}</div>
            </div>
          `;
        }
      } catch (error) {
        resultDiv.classList.remove('hidden');
        resultDiv.innerHTML = `
          <div class="warning-box">
            <div class="font-medium text-yellow-800">연결 실패</div>
            <div class="text-sm text-yellow-700 mt-1">${error.message}</div>
          </div>
        `;
      }

      btn.disabled = false;
      btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg> 백필 실행';
    }
  </script>
</body>
</html>
